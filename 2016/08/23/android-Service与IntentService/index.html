<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Service,IntentService,AIDL,è¿œç¨‹æœåŠ¡,Serviceä¿æ´»," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="Serviceæ˜¯ä»€ä¹ˆï¼Ÿ
Serviceçš„åŸºæœ¬ç”¨æ³•
Service#onStartCommand()çš„è¿”å›å€¼
IntentServiceçš„ç”¨æ³•
Bound Service
ä¸€äº›Serviceä¿æ´»çš„æ–¹æ³•

[TOC]
Serviceæ˜¯ä»€ä¹ˆï¼Ÿåœ¨androidä¸­Serviceæ˜¯åªåœ¨åå°æ‰§è¡Œæ“ä½œä¸”æ²¡æœ‰é¡µé¢çš„ç»„ä»¶ã€‚Serviceå¯ä»¥è¢«Serviceã€Activityã€ContentProviderå¯åŠ¨/ç»‘å®š">
<meta property="og:type" content="article">
<meta property="og:title" content="android-Serviceä¸IntentService">
<meta property="og:url" content="http://yoursite.com/2016/08/23/android-Serviceä¸IntentService/index.html">
<meta property="og:site_name" content="ç›¸ä¿¡ä¸å¯èƒ½">
<meta property="og:description" content="Serviceæ˜¯ä»€ä¹ˆï¼Ÿ
Serviceçš„åŸºæœ¬ç”¨æ³•
Service#onStartCommand()çš„è¿”å›å€¼
IntentServiceçš„ç”¨æ³•
Bound Service
ä¸€äº›Serviceä¿æ´»çš„æ–¹æ³•

[TOC]
Serviceæ˜¯ä»€ä¹ˆï¼Ÿåœ¨androidä¸­Serviceæ˜¯åªåœ¨åå°æ‰§è¡Œæ“ä½œä¸”æ²¡æœ‰é¡µé¢çš„ç»„ä»¶ã€‚Serviceå¯ä»¥è¢«Serviceã€Activityã€ContentProviderå¯åŠ¨/ç»‘å®š">
<meta property="og:image" content="http://oc1ju78pc.bkt.clouddn.com/%E5%93%88%E5%93%88%E5%93%88_%E5%A7%9A%E6%98%8E.jpg">
<meta property="og:image" content="http://oc1ju78pc.bkt.clouddn.com/%E5%93%88%E5%93%88%E5%93%88_%E5%A7%9A%E6%98%8E.jpg">
<meta property="og:image" content="http://oc1ju78pc.bkt.clouddn.com/%E5%93%88%E5%93%88%E5%93%88_%E5%A7%9A%E6%98%8E.jpg">
<meta property="og:updated_time" content="2016-08-23T09:31:24.461Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="android-Serviceä¸IntentService">
<meta name="twitter:description" content="Serviceæ˜¯ä»€ä¹ˆï¼Ÿ
Serviceçš„åŸºæœ¬ç”¨æ³•
Service#onStartCommand()çš„è¿”å›å€¼
IntentServiceçš„ç”¨æ³•
Bound Service
ä¸€äº›Serviceä¿æ´»çš„æ–¹æ³•

[TOC]
Serviceæ˜¯ä»€ä¹ˆï¼Ÿåœ¨androidä¸­Serviceæ˜¯åªåœ¨åå°æ‰§è¡Œæ“ä½œä¸”æ²¡æœ‰é¡µé¢çš„ç»„ä»¶ã€‚Serviceå¯ä»¥è¢«Serviceã€Activityã€ContentProviderå¯åŠ¨/ç»‘å®š">
<meta name="twitter:image" content="http://oc1ju78pc.bkt.clouddn.com/%E5%93%88%E5%93%88%E5%93%88_%E5%A7%9A%E6%98%8E.jpg">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'åšä¸»'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/2016/08/23/android-Serviceä¸IntentService/"/>

  <title> android-Serviceä¸IntentService | ç›¸ä¿¡ä¸å¯èƒ½ </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">ç›¸ä¿¡ä¸å¯èƒ½</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Just do it.</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            å…¬ç›Š404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                android-Serviceä¸IntentService
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">å‘è¡¨äº</span>
            <time itemprop="dateCreated" datetime="2016-08-23T10:55:52+08:00" content="2016-08-23">
              2016-08-23
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/23/android-Serviceä¸IntentService/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/23/android-Serviceä¸IntentService/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
              &nbsp; | &nbsp;
              <span class="page-pv"><i class="fa fa-file-o"></i>
              <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
              </span>
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <ol>
<li>Serviceæ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>Serviceçš„åŸºæœ¬ç”¨æ³•</li>
<li>Service#onStartCommand()çš„è¿”å›å€¼</li>
<li>IntentServiceçš„ç”¨æ³•</li>
<li>Bound Service</li>
<li>ä¸€äº›Serviceä¿æ´»çš„æ–¹æ³•</li>
</ol>
<p>[TOC]</p>
<h1 id="Serviceæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Serviceæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Serviceæ˜¯ä»€ä¹ˆï¼Ÿ"></a>Serviceæ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>åœ¨androidä¸­Serviceæ˜¯åªåœ¨åå°æ‰§è¡Œæ“ä½œä¸”æ²¡æœ‰é¡µé¢çš„ç»„ä»¶ã€‚Serviceå¯ä»¥è¢«Serviceã€Activityã€ContentProviderå¯åŠ¨/ç»‘å®šï¼Œä½†æ˜¯ä¸å¯ä»¥è¢«Broadcastå¯åŠ¨/ç»‘å®šã€‚æ¢å¥è¯è¯´ï¼ŒActivityã€ContentProviderå¯ä»¥ç»‘å®šåˆ°Serviceå¹¶ä¸ä¹‹äº¤äº’ï¼Œç”šè‡³è¿›è¡ŒIPCé€šè®¯ã€‚</p>
<blockquote>
<p>æœåŠ¡æ ¹æ®ç”¨é€”ä¸åŒè€Œåˆ†ä¸ºä¸¤ç±»ï¼šå¯åŠ¨çš„æœåŠ¡å’Œç»‘å®šçš„æœåŠ¡ã€‚</p>
</blockquote>
<h1 id="Serviceçš„åŸºæœ¬ç”¨æ³•ã€‚"><a href="#Serviceçš„åŸºæœ¬ç”¨æ³•ã€‚" class="headerlink" title="Serviceçš„åŸºæœ¬ç”¨æ³•ã€‚"></a>Serviceçš„åŸºæœ¬ç”¨æ³•ã€‚</h1><p>è¦å®ç°è‡ªå·±çš„Serviceå»å®Œæˆä¸€äº›åå°æ“ä½œï¼Œå¿…é¡»ç»§æ‰¿è‡ªServiceï¼Œå¹¶é‡å†™å®ƒçš„onCreate(), onStartCommand(), onDestroy()æ–¹æ³•ã€‚</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyService</span> <span class="keyword">extends</span> <span class="title">Service</span></span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"MyService"</span>;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span></span>&#123;</div><div class="line">        <span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">onStartCommand</span><span class="params">(intent, flags, startId)</span></span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDestroy();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function">IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç„¶ååœ¨androidManifest.xmlä¸­è¿›è¡Œæ³¨å†Œ</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Service android:<span class="built_in">name</span>=<span class="string">"packageName.MyService"</span>/&gt;</div></pre></td></tr></table></figure>
<p>è¿™æ ·ä¸€ä¸ªå®Œæ•´çš„Serviceå°±å®Œæˆäº†ï¼Œç°åœ¨æˆ‘ä»¬åªéœ€è¦å¯åŠ¨å®ƒå°±å¯ä»¥äº†ã€‚å¯åŠ¨Serviceçš„æ–¹æ³•å’Œå¯åŠ¨Activityçš„æ–¹æ³•ç±»ä¼¼ï¼š</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Intent</span> <span class="keyword">intent</span> = new <span class="keyword">Intent</span>(this, MyService.<span class="keyword">class</span>);</div><div class="line">startService(<span class="keyword">intent</span>);</div></pre></td></tr></table></figure>
<p>æ—¢ç„¶æœ‰å¯åŠ¨Serviceï¼Œé‚£ä¹ˆè‚¯å®šæœ‰åœæ­¢Serviceï¼Œåœæ­¢Serviceçš„æ–¹æ³•ä¸ºï¼š</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Intent</span> <span class="keyword">intent</span> = new <span class="keyword">Intent</span>(this, MyService.<span class="keyword">class</span>);</div><div class="line">stopService(<span class="keyword">intent</span>);</div></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„ï¼šæ— è®ºå¯åŠ¨å¤šå°‘æ¬¡Serviceï¼Œåªè¦Serviceè¿˜æ²¡æœ‰è¢«stopï¼Œé‚£ä¹ˆService#onCreateæ–¹æ³•å§‹ç»ˆåªæ‰§è¡Œä¸€æ¬¡ã€‚æ¢è¨€ä¹‹ï¼Œå¦‚æœServiceå·²ç»è¢«å¯åŠ¨äº†ï¼ŒService#onCreateå°±ä¸å†æ‰§è¡Œäº†ï¼Œä½†onStartCommandæ¯æ¬¡éƒ½ä¼šæ‰§è¡Œã€‚</p>
</blockquote>
<p>Serviceè™½ç„¶è¢«ç”¨æ¥å¤„ç†ä¸€äº›åå°ä»»åŠ¡ï¼Œä½†å®ƒè¿è¡Œåœ¨ä¸»çº¿ç¨‹ï¼ˆMainThreadï¼‰ï¼Œå› æ­¤å¦‚æœç›´æ¥åœ¨onStartCommand()ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œï¼Œåˆ™ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œå…·ä½“è¡¨ç°ä¸ºï¼šé™¤éonStartCommand()çš„è€—æ—¶æ“ä½œæ‰§è¡Œå®Œæ¯•ï¼Œå¦åˆ™ç•Œé¢ä¸Šæ— æ³•è¿›è¡Œä»»ä½•æ“ä½œã€‚æ‰€ä»¥å¦‚æœè¦åœ¨Serviceä¸­æ‰§è¡Œè€—æ—¶æ“ä½œï¼ˆä¾‹å¦‚ç½‘ç»œè¯·æ±‚ï¼ŒIOæµå¤„ç†ï¼‰ï¼Œåˆ™å¿…é¡»åˆ›å»ºThreadæ¥å®Œæˆè¿™äº›è€—æ—¶æ“ä½œã€‚é‚£ä¹ˆæœ‰çš„æœ‹å‹å¯èƒ½ä¼šé—®ï¼Œæ—¢ç„¶åå°çš„è€—æ—¶æ“ä½œè¦ä½¿ç”¨Threadæ¥æ‰§è¡Œï¼Œé‚£ä¹ˆåˆä¸ºä»€ä¹ˆä½¿ç”¨Serviceå‘¢ï¼Ÿç›´æ¥ä½¿ç”¨Threadå°±å¯ä»¥äº†å‘€ï¼å…¶å®ä½¿ç”¨Serviceçš„åŸå› åœ¨äºandroidç³»ç»Ÿå°†Serviceçš„ä¼˜å…ˆçº§è®¾ç½®çš„å¾ˆé«˜ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ç³»ç»Ÿå› ä¸ºå†…å­˜ä¸è¶³è€Œè¦å›æ”¶æŸäº›ä»»åŠ¡æ—¶ï¼ŒThreadä¼šæ¯”Serviceå…ˆè¢«é”€æ¯æ¥é‡Šæ”¾å†…å­˜ï¼Œè€Œä¸”Threadçš„å­˜æ´»ä¸å¦ä¸å¯åŠ¨å®ƒçš„å®¿ä¸»ï¼ˆä¾‹å¦‚Activityï¼‰çš„é”€æ¯ä¸å¦æ— å…³ï¼Œé‚£ä¹ˆå¦‚æœå®¿ä¸»è¢«é”€æ¯äº†ï¼Œæˆ‘ä»¬å°±æ— æ³•æ§åˆ¶Threadçš„å­˜æ´»äº†ï¼Œä½†æ˜¯Serviceåˆ™ä¸åŒï¼Œæˆ‘ä»¬å¯ä»¥éšæ—¶éšåœ°çš„æ§åˆ¶Serviceçš„å­˜æ´»ã€‚</p>
<p>å…¶å®ï¼Œandroidè¿˜æä¾›äº†ä¸€ä¸ªå«åšIntentServiceçš„ç»„ä»¶æ¥å®ç°è€—æ—¶æ“ä½œçš„Serviceï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ ä½¿ç”¨IntentServiceæ›¿ä»£Serviceï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦newä¸€ä¸ªThreadæ¥æ‰§è¡Œè€—æ—¶æ“ä½œäº†ï¼ŒIntentServiceæœ¬èº«å°±æä¾›äº†è¿™ç§æœºåˆ¶ã€‚</p>
<p>é‚£ä¹ˆï¼Œç°åœ¨æˆ‘ä»¬æ¥è€ƒè™‘ä¸€ä¸‹ï¼šé¦–å…ˆåœ¨Activityä¸­å¯åŠ¨Serviceï¼Œå¦‚æœä¹‹åè¯¥Activityè¢«finishæ‰äº†ï¼Œé‚£ä¹ˆæ­¤æ—¶Serviceä¼šè¢«destroyå—ï¼Ÿç­”æ¡ˆæ˜¯NOã€‚æƒ³æƒ³çœ‹ï¼Œæ—¢ç„¶Serviceæ˜¯ç”¨æ¥æ‰§è¡Œåå°æ“ä½œçš„ï¼Œé‚£ä¹ˆå®ƒè‚¯å®šè¦ç‹¬ç«‹äºå¯åŠ¨å®ƒçš„ç»„ä»¶ï¼Œå¦åˆ™Serviceå°±æ— æ³•ä¸€ç›´åœ¨åå°æ‰§è¡Œäº†ã€‚ä½†æ˜¯ï¼Œåé¢æˆ‘ä»¬è¦è¯´çš„ç»‘å®šServiceï¼Œåˆ™ä¸æ˜¯è¿™æ ·ï¼Œå¦‚æœç»‘å®šServiceçš„å®¢æˆ·ç«¯è¢«é”€æ¯äº†ï¼Œåˆ™è¯¥Serviceä¹Ÿè¢«é”€æ¯ï¼Œå…·ä½“æˆ‘ä»¬åè¾¹å†æ¥è¯¦ç»†è¯´æ˜ã€‚</p>
<h1 id="Service-onStartCommand-çš„è¿”å›å€¼"><a href="#Service-onStartCommand-çš„è¿”å›å€¼" class="headerlink" title="Service#onStartCommand()çš„è¿”å›å€¼"></a>Service#onStartCommand()çš„è¿”å›å€¼</h1><p>åœ¨ä¸Šä¸€èŠ‚æˆ‘ä»¬æ³¨æ„åˆ°åœ¨Service#onStartCommandä¸­è¿”å›äº†ä¸€ä¸ªintå€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ</p>
<p>Service#onStartCommand()å¯ä»¥è¿”å›å››ä¸ªå€¼ï¼šSTART_STICKY, START_NOT_STICKY, START_REDELIVER_INTENT, START_STICKY_COMPATIBILITY.</p>
<p><strong>START_STICKY</strong>ï¼šè¿”å›è¯¥å€¼åˆ™è¡¨ç¤ºå¦‚æœServiceæ‰€åœ¨çš„è¿›ç¨‹è¢«ç³»ç»Ÿkillä¹‹åï¼Œå°†è¯¥Serviceç½®äºstartedï¼ˆå·²å¯åŠ¨ï¼‰çŠ¶æ€ï¼Œä½†æ˜¯ä¸ä¼šå°†ç¬¬ä¸€æ¬¡å¯åŠ¨Serviceæ—¶çš„intentå€¼æ¢å¤ã€‚å› ä¸ºè¯¥Serviceå¤„äºstartedçŠ¶æ€ï¼Œæ‰€ä»¥ä¼šä¿è¯é‡å¯Serviceä¹‹åå†æ¬¡æ‰§è¡ŒonStartCommand()æ–¹æ³•,æ­¤æ—¶å¦‚æœæ²¡æœ‰intentä¼ é€’è¿‡æ¥ï¼Œåˆ™å°†ä»¥null objectçš„å½¢å¼å»è°ƒç”¨ã€‚</p>
<p><strong>START_NOT_STICKY</strong>ï¼šè¿”å›è¯¥å€¼åˆ™è¡¨ç¤ºå¦‚æœServiceæ‰€åœ¨çš„è¿›ç¨‹è¢«ç³»ç»Ÿkillä¹‹åï¼Œåˆ™ç³»ç»Ÿä¸ä¼šä¸»åŠ¨é‡å¯è¯¥Serviceã€‚</p>
<p><strong>START_REDELIVERY_INTENT</strong>ï¼šè§åçŸ¥æ„ï¼Œè¿”å›è¯¥å€¼åˆ™è¡¨ç¤ºå¦‚æœServiceæ‰€åœ¨çš„è¿›ç¨‹è¢«ç³»ç»Ÿkillä¹‹åï¼Œå°†è¯¥Serviceç½®äºstartedï¼ˆå·²å¯åŠ¨ï¼‰çŠ¶æ€å¹¶å°†ä¹‹å‰çš„intentå€¼æ¢å¤ã€‚</p>
<p><strong>START_STICKY_COMPATIBILITY</strong>ï¼šSTART_STICKYçš„å…¼å®¹ç‰ˆæœ¬ï¼Œè€Œä¸”ä¸ä¿è¯Serviceæ‰€åœ¨çš„è¿›ç¨‹è¢«killä¹‹åï¼ŒServiceä¼šè¢«é‡å¯ã€‚</p>
<h1 id="IntentServiceçš„åŸºæœ¬ç”¨æ³•åŠåŸç†"><a href="#IntentServiceçš„åŸºæœ¬ç”¨æ³•åŠåŸç†" class="headerlink" title="IntentServiceçš„åŸºæœ¬ç”¨æ³•åŠåŸç†"></a>IntentServiceçš„åŸºæœ¬ç”¨æ³•åŠåŸç†</h1><p>æ­£å¦‚ä¸Šé¢æ‰€è¯´çš„ï¼ŒIntentServiceæ˜¯ä¸€ç§ç‰¹æ®Šçš„serviceï¼Œå¯ä»¥ç›´æ¥åœ¨é‡Œé¢æ‰§è¡Œè€—æ—¶æ“ä½œã€‚</p>
<h2 id="IntentServiceçš„åŸºæœ¬ç”¨æ³•"><a href="#IntentServiceçš„åŸºæœ¬ç”¨æ³•" class="headerlink" title="IntentServiceçš„åŸºæœ¬ç”¨æ³•"></a>IntentServiceçš„åŸºæœ¬ç”¨æ³•</h2><p>é¦–å…ˆæˆ‘ä»¬è‚¯å®šè¦ç»§æ‰¿IntentServiceï¼Œç„¶åå®ç°onHandleIntent(Intent intent)æ–¹æ³•ã€‚</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyIntentService</span> <span class="keyword">extends</span> <span class="title">IntentService</span> </span>&#123;</div><div class="line"></div><div class="line">    public <span class="type">MyIntentService</span>() &#123;</div><div class="line">        <span class="keyword">super</span>(<span class="string">"MyIntentService"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">protected</span> void onHandleIntent(<span class="type">Intent</span> intent) &#123;</div><div class="line">        <span class="keyword">if</span> (intent != <span class="literal">null</span>) &#123;</div><div class="line">            <span class="comment">//do something consuming time.</span></div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                <span class="type">Thread</span>.sleep(<span class="number">2000</span>);</div><div class="line">            &#125; <span class="keyword">catch</span> (<span class="type">InterruptedException</span> e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;   </div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç„¶ååœ¨AndroidManifestä¸­æ³¨å†Œï¼š</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;service</div><div class="line">        android:<span class="built_in">name</span>=<span class="string">".service.MyIntentService"</span></div><div class="line">        android:exported=<span class="string">"false"</span>/&gt;</div></pre></td></tr></table></figure>
<p>ä¹‹åæˆ‘ä»¬åƒå¯åŠ¨/åœæ­¢Serviceä¸€æ ·å»å¯åŠ¨/åœæ­¢IntentServiceå³å¯ã€‚ä¹‹åæˆ‘ä»¬å°±å¯ä»¥åœ¨IntentService#onHandleIntentä¸­æ‰§è¡Œè€—æ—¶æ“ä½œã€‚</p>
<p>æˆ‘ä»¬çœ‹åˆ°åœ¨æ³¨å†Œserviceæ—¶ï¼Œæœ‰æ—¶ä¼šä½¿ç”¨android:exportedè¿™ä¸ªå±æ€§ï¼Œè¿™ä¸ªå±æ€§ç”¨æ¥è¯´æ˜è¯¥Serviceæ˜¯å¦å¯ä»¥è¢«å¤–éƒ¨åº”ç”¨ä½¿ç”¨ã€‚é»˜è®¤ä¸ºfalseã€‚</p>
<h2 id="IntentServiceåŸç†è§£æ"><a href="#IntentServiceåŸç†è§£æ" class="headerlink" title="IntentServiceåŸç†è§£æ"></a>IntentServiceåŸç†è§£æ</h2><p>åœ¨androidä¸­ï¼Œé€šå¸¸ä½¿ç”¨Handleræ¥å®ç°çº¿ç¨‹åˆ‡æ¢åŠåä½œï¼Œä½¿ç”¨HandlerThreadæ¥åˆ›å»ºä¸€ä¸ªå¸¦æœ‰Looperçš„çº¿ç¨‹ã€‚é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹IntentServiceçš„æºç ï¼Œçœ‹çœ‹å®ƒæ˜¯ä¸æ˜¯ä½¿ç”¨äº†Handlerå’ŒHandlerThreadæ¥å®ç°çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">IntentService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Looper mServiceLooper;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> ServiceHandler mServiceHandler;</div><div class="line">    <span class="keyword">private</span> String mName;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mRedelivery;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ServiceHandler</span><span class="params">(Looper looper)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>(looper);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</div><div class="line">            onHandleIntent((Intent)msg.obj);</div><div class="line">            stopSelf(msg.arg1);<span class="comment">//åœæ­¢è‡ªå·±</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Creates an IntentService.  Invoked by your subclass's constructor.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> name Used to name the worker thread, important only for debugging.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">IntentService</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>();</div><div class="line">        mName = name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Sets intent redelivery preferences.  Usually called from the constructor</div><div class="line">     * with your preferred semantics.</div><div class="line">     *</div><div class="line">     * &lt;p&gt;If enabled is true,</div><div class="line">     * &#123;<span class="doctag">@link</span> #onStartCommand(Intent, int, int)&#125; will return</div><div class="line">     * &#123;<span class="doctag">@link</span> Service#START_REDELIVER_INTENT&#125;, so if this process dies before</div><div class="line">     * &#123;<span class="doctag">@link</span> #onHandleIntent(Intent)&#125; returns, the process will be restarted</div><div class="line">     * and the intent redelivered.  If multiple Intents have been sent, only</div><div class="line">     * the most recent one is guaranteed to be redelivered.</div><div class="line">     *</div><div class="line">     * &lt;p&gt;If enabled is false (the default),</div><div class="line">     * &#123;<span class="doctag">@link</span> #onStartCommand(Intent, int, int)&#125; will return</div><div class="line">     * &#123;<span class="doctag">@link</span> Service#START_NOT_STICKY&#125;, and if the process dies, the Intent</div><div class="line">     * dies along with it.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIntentRedelivery</span><span class="params">(<span class="keyword">boolean</span> enabled)</span> </span>&#123;</div><div class="line">        mRedelivery = enabled;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// <span class="doctag">TODO:</span> It would be nice to have an option to hold a partial wakelock</span></div><div class="line">        <span class="comment">// during processing, and to have a static startService(Context, Intent)</span></div><div class="line">        <span class="comment">// method that would launch the service &amp; hand off a wakelock.</span></div><div class="line"></div><div class="line">        <span class="keyword">super</span>.onCreate();</div><div class="line">        HandlerThread thread = <span class="keyword">new</span> HandlerThread(<span class="string">"IntentService["</span> + mName + <span class="string">"]"</span>);</div><div class="line">        thread.start();</div><div class="line"></div><div class="line">        mServiceLooper = thread.getLooper();</div><div class="line">        mServiceHandler = <span class="keyword">new</span> ServiceHandler(mServiceLooper);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">(Intent intent, <span class="keyword">int</span> startId)</span> </span>&#123;</div><div class="line">        Message msg = mServiceHandler.obtainMessage();</div><div class="line">        msg.arg1 = startId;</div><div class="line">        msg.obj = intent;</div><div class="line">        mServiceHandler.sendMessage(msg);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * You should not override this method for your IntentService. Instead,</div><div class="line">     * override &#123;<span class="doctag">@link</span> #onHandleIntent&#125;, which the system calls when the IntentService</div><div class="line">     * receives a start request.</div><div class="line">     * <span class="doctag">@see</span> android.app.Service#onStartCommand</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</div><div class="line">        onStart(intent, startId);</div><div class="line">        <span class="keyword">return</span> mRedelivery ? START_REDELIVER_INTENT : START_NOT_STICKY;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</div><div class="line">        mServiceLooper.quit();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Unless you provide binding for your service, you don't need to implement this</div><div class="line">     * method, because the default implementation returns null. </div><div class="line">     * <span class="doctag">@see</span> android.app.Service#onBind</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * This method is invoked on the worker thread with a request to process.</div><div class="line">     * Only one Intent is processed at a time, but the processing happens on a</div><div class="line">     * worker thread that runs independently from other application logic.</div><div class="line">     * So, if this code takes a long time, it will hold up other requests to</div><div class="line">     * the same IntentService, but it will not hold up anything else.</div><div class="line">     * When all requests have been handled, the IntentService stops itself,</div><div class="line">     * so you should not call &#123;<span class="doctag">@link</span> #stopSelf&#125;.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> intent The value passed to &#123;<span class="doctag">@link</span></div><div class="line">     *               android.content.Context#startService(Intent)&#125;.</div><div class="line">     */</div><div class="line">    <span class="meta">@WorkerThread</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">onHandleIntent</span><span class="params">(Intent intent)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä»æºç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒIntentServiceæ­£æ˜¯ä½¿ç”¨äº†Handlerå’ŒHandlerThreadæ¥å®ç°çš„ï¼Œå…·ä½“å®ç°æµç¨‹å¦‚ä¸‹ï¼š
é¦–å…ˆï¼Œæˆ‘ä»¬è¦å¯åŠ¨IntentServiceï¼Œé‚£ä¹ˆåˆ™è‚¯å®šä¼šå…ˆæ‰§è¡ŒonCreateæ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å…¶æºç ï¼š</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// <span class="doctag">TODO:</span> It would be nice to have an option to hold a partial wakelock</span></div><div class="line">        <span class="comment">// during processing, and to have a static startService(Context, Intent)</span></div><div class="line">        <span class="comment">// method that would launch the service &amp; hand off a wakelock.</span></div><div class="line">        <span class="keyword">super</span>.onCreate();</div><div class="line">        HandlerThread thread = <span class="keyword">new</span> HandlerThread(<span class="string">"IntentService["</span> + mName + <span class="string">"]"</span>);</div><div class="line">        thread.start();</div><div class="line">        mServiceLooper = thread.getLooper();</div><div class="line">        mServiceHandler = <span class="keyword">new</span> ServiceHandler(mServiceLooper);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>åœ¨onCreateä¸­ï¼Œé¦–å…ˆä½¿ç”¨HandlerThreadæ¥åˆ›å»ºä¸€ä¸ªå¸¦æœ‰Looperçš„çº¿ç¨‹ï¼ŒæŒ‡å®šè¯¥çº¿ç¨‹çš„åå­—å«åšmNameï¼Œç„¶åå¯åŠ¨çº¿ç¨‹ï¼Œæ¥ç€å¾—åˆ°è¯¥çº¿ç¨‹çš„Looperå¯¹è±¡ï¼Œå¾—åˆ°Looperä¹‹åå†å»åˆå§‹åŒ–Handlerã€‚è‡³æ­¤ï¼Œå°±å®Œæˆäº†çº¿ç¨‹åˆ›å»ºå’Œçº¿ç¨‹åˆ‡æ¢çš„å‡†å¤‡å·¥ä½œã€‚</p>
<p>æ¥ç€ä¼šå»è°ƒç”¨IntentService#onStartCommand()ã€å…ˆå¿½ç•¥è¿”å›å€¼å§ğŸ˜„ã€‘,è€ŒonStartCommandåˆè°ƒç”¨äº†onStart(),é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹çœ‹onStart()æ–¹æ³•çš„å…·ä½“å®ç°ï¼š</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onStart</span><span class="params">(Intent intent, <span class="keyword">int</span> startId)</span> </span>&#123;</div><div class="line">        Message msg = mServiceHandler.obtainMessage();</div><div class="line">        msg.arg1 = startId;</div><div class="line">        msg.obj = intent;</div><div class="line">        mServiceHandler.sendMessage(msg);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>ä»æºç å¯ä»¥çœ‹å‡ºï¼Œåœ¨onStartä¸­å‘Handlerå‘é€äº†ä¸€ä¸ªMessageï¼Œhandleråœ¨æ¥æ”¶åˆ°è¯¥Messageä¹‹åä¼šå›è°ƒHandler#handlerMessage(Msg)æ–¹æ³•ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹ServiceHandlerçš„å®ç°ï¼š</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</div><div class="line">        public <span class="type">ServiceHandler</span>(<span class="type">Looper</span> looper) &#123;</div><div class="line">            <span class="keyword">super</span>(looper);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        public void handleMessage(<span class="type">Message</span> msg) &#123;</div><div class="line">            onHandleIntent((<span class="type">Intent</span>)msg.obj);</div><div class="line">            stopSelf(msg.arg1);<span class="comment">//åœæ­¢è‡ªå·±</span></div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨handleMessageæ–¹æ³•ä¸­æ‰§è¡Œäº†è€—æ—¶æ“ä½œonHandleIntentï¼Œæ‰§è¡Œå®Œè€—æ—¶æ“ä½œä¹‹åå°±åœæ­¢è‡ªå·±ã€‚</p>
<p>è‡³æ­¤ï¼ŒIntentServiceçš„å®ç°åŸç†å·²ç»éå¸¸æ¸…æ¥šäº†ï¼šä½¿ç”¨äº†HandlerThreadæ¥åˆ›å»ºçº¿ç¨‹æ‰§è¡Œè€—æ—¶æ“ä½œï¼Œä½¿ç”¨Handleræ¥å‘é€æ¶ˆæ¯ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong> IntentServieæ‰§è¡Œå®Œè€—æ—¶æ“ä½œä¹‹åä¼šè‡ªåŠ¨åœæ­¢</p>
</blockquote>
<p>åœ¨æ­¤ï¼Œè¿˜æœ‰ä¸€ä¸ªéšè—çš„çŸ¥è¯†ç‚¹éœ€è¦è¯´æ˜ï¼šæˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œå¤šæ¬¡å¯åŠ¨Serviceä¹‹åï¼ŒService#onCreate()åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼ŒService#onStartCommand()åˆ™ä¼šæ‰§è¡Œå¤šæ¬¡ï¼Œé‚£ä¹ˆåœ¨IntentServiceä¸­ï¼Œhandlerå°±ä¼šå¤šæ¬¡å‘é€æ¶ˆæ¯å¹¶æ‰§è¡Œè€—æ—¶æ“ä½œã€‚ç”±äºHandlerçš„æ¶ˆæ¯æœºåˆ¶ä½¿ç”¨äº†é˜Ÿåˆ—ï¼Œé‚£ä¹ˆåœ¨IntentServiceä¸­ï¼Œå¤šæ¬¡å¯åŠ¨Serviceä¹‹åï¼Œè¿™äº›è€—æ—¶æ“ä½œä¹Ÿä¼šæ’é˜Ÿæ‰§è¡Œã€‚</p>
<p>åœ¨æ­¤æœ‰çš„æœ‹å‹å°±ä¼šé—®äº†ï¼šåœ¨IntentServiceä¸­ï¼Œæ‰§è¡Œå®Œè€—æ—¶æ“ä½œä¹‹åä¼šstopSelfï¼Œé‚£ä¹ˆæ­¤æ—¶æœ‰å¤šä¸ªä»»åŠ¡æ’é˜Ÿç­‰å¾…å¤„ç†ï¼Œè¿™å²‚ä¸æ˜¯è‡ªç›¸çŸ›ç›¾å—ï¼Ÿäº‹å®ä¸Šä¸æ˜¯å¦‚æ­¤ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¸€ä¸€è¯´æ˜ï¼š</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨Service#onStartCommand(Intent intent, int flags, int startId)å’ŒstopSelf(int startId)ä¸­æœ‰ä¸€ä¸ªå‚æ•°startIdï¼Œè¯¥å‚æ•°æ ‡è¯†æ¯æ¬¡å¯åŠ¨Serviceçš„è¯·æ±‚ã€‚startIdåˆå§‹å€¼ä¸º1ï¼Œå¦‚æœåœ¨å¯åŠ¨Serviceæ—¶ï¼Œè¯¥Serviceå·²ç»è¢«å¯åŠ¨ä¸”æœªæ‰§è¡Œå®Œæ¯•ï¼Œé‚£ä¹ˆstartIdé€’å¢ï¼›å¦‚æœå¯åŠ¨Serviceæ—¶ï¼Œè¯¥Serviceä¹‹å‰æœªè¢«å¯åŠ¨æˆ–å·²ç»è‡ªåœæ­¢ï¼Œåˆ™startIdä¸º1ã€‚startIdæ ‡è¯†äº†å¯åŠ¨Serviceè¿™ä¸ªè¯·æ±‚å’Œå¯¹åº”çš„intentã€‚æ‰€ä»¥æ¯æ¬¡stopSelf(startId)æ—¶ï¼Œä¼šå…³é—­å½“å‰startIdå¯¹åº”çš„Serviceï¼Œå’Œé˜Ÿåˆ—ä¸­å…¶ä»–çš„Serviceæ— å…³ã€‚</p>
<h1 id="Bound-Service"><a href="#Bound-Service" class="headerlink" title="Bound Service"></a>Bound Service</h1><p>å‰é¢æˆ‘ä»¬ä½¿ç”¨å¯åŠ¨Serviceçš„æ–¹å¼ä½¿å¾—Serviceæ¥å®Œæˆä¸€äº›åå°ä»»åŠ¡ï¼Œä½†æ˜¯å¯åŠ¨Serviceçš„å®¢æˆ·ç«¯å’ŒServiceä¹‹é—´å¹¶æ²¡æœ‰åšä»»ä½•äº¤äº’ï¼Œé‚£ä¹ˆäºŒè€…å¦‚æœè¦è¿›è¡Œäº¤äº’ï¼Œåˆ™å¿…é¡»ä½¿ç”¨ç»‘å®šServiceçš„æ–¹å¼ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“å››å¤§ç»„ä»¶éƒ½å¯ä»¥é€šè¿‡è®¾ç½®android:process=â€:remoteâ€å±æ€§è®©å…¶æœ¬èº«å¤„äºå¦ä¸€ä¸ªè¿›ç¨‹ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬ç»‘å®šServiceæ—¶ï¼Œå°±æœ‰æœ¬åœ°ç»‘å®šå’Œè¿œç¨‹ç»‘å®šä¹‹åˆ†ã€‚å¾ˆæ˜æ˜¾æœ¬åœ°ç»‘å®šæ˜¯æŒ‡Serviceå’Œå®¢æˆ·ç«¯å¤„äºåŒä¸€ä¸ªè¿›ç¨‹ï¼Œè¿œç¨‹ç»‘å®šåˆ™æ˜¯Serviceå’Œå®¢æˆ·ç«¯å¤„äºä¸åŒçš„è¿›ç¨‹ã€‚å…¶å®ä½¿ç”¨startService(intent)å¯åŠ¨Serviceæ—¶ï¼Œä¹Ÿæœ‰æœ¬åœ°å¯åŠ¨å’Œè¿œç¨‹å¯åŠ¨ä¹‹åˆ†ï¼Œä½†æ˜¯é€šè¿‡startService(intent)å¯åŠ¨çš„Serviceå’Œå®¢æˆ·ç«¯ä¹‹é—´å¹¶æ²¡æœ‰åšä»»ä½•äº¤äº’ï¼Œè€Œè¿œç¨‹æœåŠ¡é€šå¸¸æä¾›ä¸€äº›ç³»ç»ŸæœåŠ¡ï¼Œéœ€è¦å®¢æˆ·ç«¯å’ŒServiceä¹‹é—´è¿›è¡Œäº¤äº’ï¼Œå› æ­¤å¯åŠ¨Serviceæ—¶æ— éœ€ä½¿ç”¨è¿œç¨‹æ¨¡å¼ã€‚</p>
<h2 id="æœ¬åœ°ç»‘å®š"><a href="#æœ¬åœ°ç»‘å®š" class="headerlink" title="æœ¬åœ°ç»‘å®š"></a>æœ¬åœ°ç»‘å®š</h2><p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æœ¬åœ°ç»‘å®šçš„åŸºæœ¬ç”¨æ³•ã€‚åœ¨æœ€å¼€å§‹çš„MyServiceä¸­ï¼Œæœ‰ä¸€ä¸ªonBind()æ–¹æ³•ï¼Œæˆ‘ä»¬è®©å®ƒè¿”å›null</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="keyword">public</span> <span class="function">IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span></span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å…¶å®onBindæ–¹æ³•å°±æ˜¯å®ç°ç»‘å®šæœåŠ¡çš„å…³é”®æ–¹æ³•ï¼Œè¦å®ç°ç»‘å®šæœåŠ¡å¿…é¡»è¦è¿”å›ä¸€ä¸ªIBinderå¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyService</span> <span class="keyword">extends</span> <span class="title">Service</span></span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"MyService"</span>;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onStartCommand(intent, flags, startId);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDestroy();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyBinder();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBinder</span> <span class="keyword">extends</span> <span class="title">Binder</span> </span>&#123;</div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span></span>&#123;</div><div class="line">            <span class="comment">//do something</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è™½ç„¶æˆ‘ä»¬è¿”å›äº†ä¸€ä¸ªIBinderå¯¹è±¡ï¼Œä½†æ˜¯æˆ‘ä»¬å¦‚ä½•åœ¨å®¢æˆ·ç«¯æ¥æ¥å—è¿™ä¸ªIBinderå¯¹è±¡å‘¢ï¼Ÿç³»ç»Ÿä¸ºæˆ‘ä»¬å®ç°äº†ServiceConnectionè¿™ä¸ªç±»æ¥å®ç°å®¢æˆ·ç«¯ä¸æœåŠ¡çš„è¿æ¥ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> ServiceConnection conn = <span class="keyword">new</span> ServiceConnection()&#123;</div><div class="line">    </div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> onServiceConnected(ComponentName name, IBinder service)&#123;</div><div class="line">        MyBinder mb = (MyService.MyBinder)service;</div><div class="line">        mb.doSomething();</div><div class="line">    &#125;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * å½“æœåŠ¡è¿æ¥å¼‚å¸¸ç»ˆæ­¢åè°ƒç”¨</div><div class="line">     */</div><div class="line">    @<span class="function">Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName name)</span>&#123;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">....</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * è‡ªå®šä¹‰æ–¹æ³•ï¼Œæ¥å®ç°ç»‘å®šService.</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">bindService</span><span class="params">()</span></span>&#123;</div><div class="line">    Intent bindIntent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, MyService.<span class="keyword">class</span>);  </div><div class="line">    bindService(bindIntent, conn, BIND_AUTO_CREATE);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * è‡ªå®šä¹‰æ–¹æ³•ï¼Œæ¥å®ç°è§£ç»‘Service.</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">unbindService</span><span class="params">()</span></span>&#123;</div><div class="line">    unbindService(conn);  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä»è¿™æ®µä»£ç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œé€šè¿‡ä½¿ç”¨ServiceConnectionæ¥å»ºç«‹å®¢æˆ·ç«¯ä¸Serviceçš„è¿æ¥ã€‚å½“è¿æ¥æˆåŠŸä¹‹åä¼šå›è°ƒServiceConnection#onServiceConnected(ComponentName name, IBinder service)æ–¹æ³•ï¼Œå°†IBinderå¯¹è±¡ä¼ é€’è¿‡æ¥ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åƒæ“ä½œè‡ªå·±çš„æ–¹æ³•ä¸€æ ·å»æ“ä½œServiceä¸­Binderå¯¹è±¡çš„æ–¹æ³•ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šServiceåªèƒ½unbindä¸€æ¬¡ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼š java.lang.IllegalArgumentException: Service not registered</p>
</blockquote>
<h2 id="è¿œç¨‹ç»‘å®š"><a href="#è¿œç¨‹ç»‘å®š" class="headerlink" title="è¿œç¨‹ç»‘å®š"></a>è¿œç¨‹ç»‘å®š</h2><p>ç°åœ¨æˆ‘ä»¬æ¥æƒ³æƒ³ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥å°†MyServiceæ”¹ä¸ºè¿œç¨‹æœåŠ¡ï¼Œä¼šæœ‰ä»€ä¹ˆæ•ˆæœå‘¢ï¼Ÿä¸å¦¨æ¥åšä¸€ä¸ªæµ‹è¯•ï¼šç›´æ¥è®¾ç½®MyServiceçš„android:process=â€:remoteâ€ã€‚è®¾ç½®å®Œä¹‹åï¼Œå½“æ‰§è¡ŒbindServiceæ—¶ï¼ŒæŠ¥ä»¥ä¸‹é”™è¯¯ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">AndroidRuntime: FATAL EXCEPTION: main                                   Process: cn<span class="selector-class">.codemperor</span>, PID: <span class="number">10998</span></div><div class="line">java<span class="selector-class">.lang</span><span class="selector-class">.ClassCastException</span>: android<span class="selector-class">.os</span><span class="selector-class">.BinderProxy</span> cannot be cast to cn<span class="selector-class">.codemperor</span><span class="selector-class">.service</span><span class="selector-class">.MyService</span><span class="variable">$MyBinder</span></div></pre></td></tr></table></figure>
<p>å’¦ï¼Ÿå¾ˆå¥‡æ€ªï¼æ€ä¹ˆä¼šæœ‰android.os.BinderProxyè¿™ä¸ªä¸œä¸œå‘¢ï¼Ÿæˆ‘ä»¬åœ¨ä»»ä½•åœ°æ–¹éƒ½æ²¡æœ‰å£°æ˜æˆ–ä½¿ç”¨å®ƒå‘€ï¼Œå®ƒæ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿæ˜¯æ€æ ·å’ŒServiceå…³è”èµ·æ¥çš„å‘¢ï¼Ÿ</p>
<p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¿…é¡»å…ˆçŸ¥é“ï¼Œè¿œç¨‹ç»‘å®šæˆ–è€…è¯´è®¿é—®è¿œç¨‹æœåŠ¡éƒ½æ˜¯IPCçš„ï¼Œä»€ä¹ˆæ˜¯IPCå‘¢ï¼ŸIPCå°±æ˜¯Inter Process Communicationï¼Œå³è¿›ç¨‹é—´é€šè®¯ã€‚åœ¨androidä¸­å®ç°ç»§æ‰¿é—´é€šè®¯çš„æ–¹å¼æ˜¯AIDL(Android Interface Define Language),å³androidæ¥å£å®šä¹‰è¯­è¨€ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å…ˆè¯¦ç»†äº†è§£ä¸€ä¸‹AIDLã€‚</p>
<h3 id="AIDLåŸºæœ¬æ¦‚å¿µåŠç”¨é€”"><a href="#AIDLåŸºæœ¬æ¦‚å¿µåŠç”¨é€”" class="headerlink" title="AIDLåŸºæœ¬æ¦‚å¿µåŠç”¨é€”"></a>AIDLåŸºæœ¬æ¦‚å¿µåŠç”¨é€”</h3><p>é¦–å…ˆæˆ‘ä»¬åº”è¯¥æ˜ç™½AIDLçš„ä½œç”¨æ˜¯ï¼šå®ç°p1è¿›ç¨‹ä¸p2è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚ä¹Ÿå°±æ˜¯è¯´AIDLæä¾›äº†ä¸€ç§æœºåˆ¶ï¼šåªè¦å®šä¹‰äº†AIDLæ–‡ä»¶ï¼Œå¹¶åœ¨AIDLæ–‡ä»¶ä¸­è§„å®šä¸šåŠ¡é€»è¾‘ï¼Œç„¶åç³»ç»Ÿå°±ä¼šè‡ªåŠ¨æ ¹æ®ä¸šåŠ¡é€»è¾‘å®ç°p1ä¸p2ä¹‹é—´çš„é€šä¿¡ã€‚å…·ä½“è¡¨ç°å¦‚ä¸‹:
<figure class="highlight coq"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">AIDLæ–‡ä»¶--&gt;å®šä¹‰ä¸šåŠ¡é€»è¾‘</div><div class="line">    |</div><div class="line"><span class="type">ç³»ç»Ÿç”Ÿæˆå®ç°è¿›ç¨‹é—´é€šä¿¡çš„ç±»æ–‡ä»¶--&gt;ç”ŸæˆStub</span>æ¥å£</div><div class="line">    |</div><div class="line"><span class="type">å®ç°Stub</span>æ¥å£--&gt;å®ç°ä¸šåŠ¡é€»è¾‘</div></pre></td></tr></table></figure></p>
<p>è¿™æ ·ä¸€çœ‹ï¼Œæˆ‘ä»¬å±€å¾ˆæ˜ç¡®çš„çŸ¥é“AIDLå®ç°è¿›ç¨‹é—´é€šè®¯çš„æœºåˆ¶ã€‚å…¶ä¸­Stubæ˜¯Binderçš„å­ç±»ã€‚</p>
<p>é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®ä¾‹æ¥å…·ä½“è¯´æ˜ä¸€ä¸‹è¿œç¨‹ç»‘å®šçš„å®ç°</p>
<h3 id="è¿œç¨‹æœåŠ¡å®ä¾‹â€“æ•°æ®è®¿é—®"><a href="#è¿œç¨‹æœåŠ¡å®ä¾‹â€“æ•°æ®è®¿é—®" class="headerlink" title="è¿œç¨‹æœåŠ¡å®ä¾‹â€“æ•°æ®è®¿é—®"></a>è¿œç¨‹æœåŠ¡å®ä¾‹â€“æ•°æ®è®¿é—®</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ–°å»ºIDataAccess.aidlæ–‡ä»¶,å¹¶åœ¨å¯åŠ¨æ•°æ®è®¿é—®æ–¹æ³•accessDataã€‚</p>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong>åœ¨aidlæ–‡ä»¶ä¸­ï¼Œä¸èƒ½å‡ºç°private, public, protectä¿®é¥°ç¬¦ã€‚åœ¨AIDLæ–‡ä»¶ä¸­ä»…èƒ½æ”¯æŒåŸºæœ¬ç±»å‹ã€Map<string>ã€List<string>ã€è‡ªå®šä¹‰ç±»å‹ã€‚å› ä¸ºè‡ªå®šä¹‰ç±»å‹å’Œå…¶ä»–ç±»å‹çš„ç”¨æ³•æœ‰æ‰€åŒºåˆ«ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹éè‡ªå®šä¹‰ç±»å‹çš„ç”¨æ³•ã€‚</string></string></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.codempero.summary;</div><div class="line"><span class="comment">// Declare any non-default types here with import statements</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IDataAccess</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">accessData</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Demonstrates some basic types that you can use as parameters</div><div class="line">     * and return values in AIDL.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">basicTypes</span><span class="params">(<span class="keyword">int</span> anInt, <span class="keyword">long</span> aLong, <span class="keyword">boolean</span> aBoolean, <span class="keyword">float</span> aFloat,</span></span></div><div class="line">            <span class="keyword">double</span> aDouble, String aString);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç„¶åç³»ç»Ÿä¼šåœ¨/build/generated/source/aidl/debug/packageName/æ–‡ä»¶å¤¹ä¸‹è‡ªåŠ¨ç”ŸæˆIDataAccess.javaæ–‡ä»¶ï¼Œè¿™ä¸ªæ¥å£å°±å®ç°äº†IPCã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®ƒçš„æºä»£ç 
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line"> * This file is auto-generated.  DO NOT MODIFY.</div><div class="line"> * Original file: D:\\LAB\\Development\\Summary\\app\\src\\main\\aidl\\cn\codemperor\summary\\IDataAccess.aidl</div><div class="line"> */</div><div class="line"><span class="keyword">package</span> cn.codemperor.summary;</div><div class="line"><span class="comment">// Declare any non-default types here with import statements</span></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IDataAccess</span> <span class="keyword">extends</span> <span class="title">android</span>.<span class="title">os</span>.<span class="title">IInterface</span></span></div><div class="line">&#123;</div><div class="line"><span class="comment">/** Local-side IPC implementation stub class. */</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Stub</span> <span class="keyword">extends</span> <span class="title">android</span>.<span class="title">os</span>.<span class="title">Binder</span> <span class="keyword">implements</span> <span class="title">cn</span>.<span class="title">codempero</span>.<span class="title">summary</span>.<span class="title">IDataAccess</span></span></div><div class="line">&#123;</div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> java.lang.String DESCRIPTOR = <span class="string">"cn.codempero.summary.IDataAccess"</span>;</div><div class="line"><span class="comment">/** Construct the stub at attach it to the interface. */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">Stub</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line"><span class="keyword">this</span>.attachInterface(<span class="keyword">this</span>, DESCRIPTOR);</div><div class="line">&#125;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * Cast an IBinder object into an cn.codempero.summary.IDataAccess interface,</div><div class="line"> * generating a proxy if needed.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> cn.codempero.summary.<span class="function">IDataAccess <span class="title">asInterface</span><span class="params">(android.os.IBinder obj)</span></span></div><div class="line">&#123;</div><div class="line"><span class="keyword">if</span> ((obj==<span class="keyword">null</span>)) &#123;</div><div class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div><div class="line">android.os.IInterface iin = obj.queryLocalInterface(DESCRIPTOR);</div><div class="line"><span class="keyword">if</span> (((iin!=<span class="keyword">null</span>)&amp;&amp;(iin <span class="keyword">instanceof</span> cn.codempero.summary.IDataAccess))) &#123;</div><div class="line"><span class="keyword">return</span> ((cn.codempero.summary.IDataAccess)iin);</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> <span class="keyword">new</span> cn.codempero.summary.IDataAccess.Stub.Proxy(obj);</div><div class="line">&#125;</div><div class="line"><span class="meta">@Override</span> <span class="keyword">public</span> android.os.<span class="function">IBinder <span class="title">asBinder</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line"><span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">&#125;</div><div class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTransact</span><span class="params">(<span class="keyword">int</span> code, android.os.Parcel data, android.os.Parcel reply, <span class="keyword">int</span> flags)</span> <span class="keyword">throws</span> android.os.RemoteException</span></div><div class="line">&#123;</div><div class="line"><span class="keyword">switch</span> (code)</div><div class="line">&#123;.</div><div class="line"><span class="keyword">case</span> INTERFACE_TRANSACTION:</div><div class="line">&#123;</div><div class="line">reply.writeString(DESCRIPTOR);</div><div class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">case</span> TRANSACTION_accessData:</div><div class="line">&#123;</div><div class="line">data.enforceInterface(DESCRIPTOR);</div><div class="line"><span class="keyword">boolean</span> _result = <span class="keyword">this</span>.accessData();</div><div class="line">reply.writeNoException();</div><div class="line">reply.writeInt(((_result)?(<span class="number">1</span>):(<span class="number">0</span>)));</div><div class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">case</span> TRANSACTION_basicTypes:</div><div class="line">&#123;</div><div class="line">data.enforceInterface(DESCRIPTOR);</div><div class="line"><span class="keyword">int</span> _arg0;</div><div class="line">_arg0 = data.readInt();</div><div class="line"><span class="keyword">long</span> _arg1;</div><div class="line">_arg1 = data.readLong();</div><div class="line"><span class="keyword">boolean</span> _arg2;</div><div class="line">_arg2 = (<span class="number">0</span>!=data.readInt());</div><div class="line"><span class="keyword">float</span> _arg3;</div><div class="line">_arg3 = data.readFloat();</div><div class="line"><span class="keyword">double</span> _arg4;</div><div class="line">_arg4 = data.readDouble();</div><div class="line">java.lang.String _arg5;</div><div class="line">_arg5 = data.readString();</div><div class="line"><span class="keyword">this</span>.basicTypes(_arg0, _arg1, _arg2, _arg3, _arg4, _arg5);</div><div class="line">reply.writeNoException();</div><div class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> <span class="keyword">super</span>.onTransact(code, data, reply, flags);</div><div class="line">&#125;</div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Proxy</span> <span class="keyword">implements</span> <span class="title">cn</span>.<span class="title">codempero</span>.<span class="title">summary</span>.<span class="title">IDataAccess</span></span></div><div class="line">&#123;</div><div class="line"><span class="keyword">private</span> android.os.IBinder mRemote;</div><div class="line">Proxy(android.os.IBinder remote)</div><div class="line">&#123;</div><div class="line">mRemote = remote;</div><div class="line">&#125;</div><div class="line"><span class="meta">@Override</span> <span class="keyword">public</span> android.os.<span class="function">IBinder <span class="title">asBinder</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line"><span class="keyword">return</span> mRemote;</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> java.lang.<span class="function">String <span class="title">getInterfaceDescriptor</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line"><span class="keyword">return</span> DESCRIPTOR;</div><div class="line">&#125;</div><div class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">accessData</span><span class="params">()</span> <span class="keyword">throws</span> android.os.RemoteException</span></div><div class="line">&#123;</div><div class="line">android.os.Parcel _data = android.os.Parcel.obtain();</div><div class="line">android.os.Parcel _reply = android.os.Parcel.obtain();</div><div class="line"><span class="keyword">boolean</span> _result;</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">_data.writeInterfaceToken(DESCRIPTOR);</div><div class="line">mRemote.transact(Stub.TRANSACTION_accessData, _data, _reply, <span class="number">0</span>);</div><div class="line">_reply.readException();</div><div class="line">_result = (<span class="number">0</span>!=_reply.readInt());</div><div class="line">&#125;</div><div class="line"><span class="keyword">finally</span> &#123;</div><div class="line">_reply.recycle();</div><div class="line">_data.recycle();</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> _result;</div><div class="line">&#125;</div><div class="line"><span class="comment">/**</span></div><div class="line">     * Demonstrates some basic types that you can use as parameters</div><div class="line">     * and return values in AIDL.</div><div class="line">     */</div><div class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">basicTypes</span><span class="params">(<span class="keyword">int</span> anInt, <span class="keyword">long</span> aLong, <span class="keyword">boolean</span> aBoolean, <span class="keyword">float</span> aFloat, <span class="keyword">double</span> aDouble, java.lang.String aString)</span> <span class="keyword">throws</span> android.os.RemoteException</span></div><div class="line">&#123;</div><div class="line">android.os.Parcel _data = android.os.Parcel.obtain();</div><div class="line">android.os.Parcel _reply = android.os.Parcel.obtain();</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">_data.writeInterfaceToken(DESCRIPTOR);</div><div class="line">_data.writeInt(anInt);</div><div class="line">_data.writeLong(aLong);</div><div class="line">_data.writeInt(((aBoolean)?(<span class="number">1</span>):(<span class="number">0</span>)));</div><div class="line">_data.writeFloat(aFloat);</div><div class="line">_data.writeDouble(aDouble);</div><div class="line">_data.writeString(aString);</div><div class="line">mRemote.transact(Stub.TRANSACTION_basicTypes, _data, _reply, <span class="number">0</span>);</div><div class="line">_reply.readException();</div><div class="line">&#125;</div><div class="line"><span class="keyword">finally</span> &#123;</div><div class="line">_reply.recycle();</div><div class="line">_data.recycle();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TRANSACTION_accessData = (android.os.IBinder.FIRST_CALL_TRANSACTION + <span class="number">0</span>);</div><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TRANSACTION_basicTypes = (android.os.IBinder.FIRST_CALL_TRANSACTION + <span class="number">1</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">accessData</span><span class="params">()</span> <span class="keyword">throws</span> android.os.RemoteException</span>;</div><div class="line"><span class="comment">/**</span></div><div class="line">     * Demonstrates some basic types that you can use as parameters</div><div class="line">     * and return values in AIDL.</div><div class="line">     */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">basicTypes</span><span class="params">(<span class="keyword">int</span> anInt, <span class="keyword">long</span> aLong, <span class="keyword">boolean</span> aBoolean, <span class="keyword">float</span> aFloat, <span class="keyword">double</span> aDouble, java.lang.String aString)</span> <span class="keyword">throws</span> android.os.RemoteException</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨IDataAccessæ¥å£é‡Œæœ‰ä¸€ä¸ªå«åšStubçš„ç±»ï¼Œå®ƒå®ç°äº†IDataAccessæ¥å£å¹¶ç»§æ‰¿è‡ªBinderï¼Œé‚£ä¹ˆè¯¥ç±»å°±æ˜¯ç”¨æ¥å®ç°IPCé€šè®¯çš„æœ¬åœ°Stubç±»ã€‚</p>
<p>é‚£ä¹ˆç°åœ¨æˆ‘ä»¬è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªè¿œç¨‹æœåŠ¡æ¥å®ç°å…·ä½“çš„ä¸šåŠ¡é€»è¾‘accessDataã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRemoteService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"MyRemoteService"</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyRemoteService</span><span class="params">()</span></span>&#123;&#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span></span>&#123;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataAccessBinder</span> <span class="keyword">extends</span> <span class="title">IDataAccess</span>.<span class="title">Stub</span> </span>&#123;</div><div class="line">    </div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">accessData</span><span class="params">()</span></span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"You can access Me!"</span>);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">basicTypes</span><span class="params">(<span class="keyword">int</span> anInt, <span class="keyword">long</span> aLong, <span class="keyword">boolean</span> aBoolean, <span class="keyword">float</span> aFloat, <span class="keyword">double</span> aDouble, java.lang.String aString)</span></span>&#123;&#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±éœ€è¦å°†MyRemoteServiceæ³¨å†Œåœ¨androidManifest.xmlä¸­</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;service </div><div class="line">    android:<span class="built_in">name</span>=<span class="string">"cn.codemperor.service.MyRemoteService"</span></div><div class="line">    android:exported=<span class="string">"true"</span></div><div class="line">    android:enable=<span class="string">"true"</span></div><div class="line">    android:process=<span class="string">":remote"</span></div><div class="line">/&gt;</div></pre></td></tr></table></figure>
<p>é‚£ä¹ˆç°åœ¨æˆ‘ä»¬åªéœ€è¦åƒç»‘å®šæœ¬åœ°æœåŠ¡ä¸€æ ·ç»‘å®šè¿œç¨‹æœåŠ¡å³å¯(çœŸçš„å¯ä»¥å—ï¼Ÿå›æƒ³ä¸€ä¸‹è®²è§£è¿œç¨‹ç»‘å®šæ˜¯çš„ç¬¬ä¸€ä¸ªå¼‚å¸¸ <img src="http://oc1ju78pc.bkt.clouddn.com/%E5%93%88%E5%93%88%E5%93%88_%E5%A7%9A%E6%98%8E.jpg" alt="å“ˆå“ˆ"> )ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> ServiceConnection conn = <span class="keyword">new</span> ServiceConnection()&#123;</div><div class="line">    </div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> onServiceConnected(ComponentName name, IBinder service)&#123;</div><div class="line">        MyRemoteService.MyBinder mb = (MyRemoteService.MyBinder)service;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            mb.endCall();</div><div class="line">        &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * å½“æœåŠ¡è¿æ¥å¼‚å¸¸ç»ˆæ­¢åè°ƒç”¨</div><div class="line">     */</div><div class="line">    @<span class="function">Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName name)</span>&#123;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">....</div><div class="line"><span class="comment">/**</span></div><div class="line"> * è‡ªå®šä¹‰æ–¹æ³•ï¼Œæ¥å®ç°ç»‘å®šService.</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">bindService</span><span class="params">()</span></span>&#123;</div><div class="line">    Intent bindIntent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, MyService.<span class="keyword">class</span>);  </div><div class="line">    bindService(bindIntent, conn, BIND_AUTO_CREATE);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * è‡ªå®šä¹‰æ–¹æ³•ï¼Œæ¥å®ç°è§£ç»‘Service.</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">unbindService</span><span class="params">()</span></span>&#123;</div><div class="line">    unbindService(conn);  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å§æ§½ï¼å§æ§½ï¼å§æ§½ï¼æ€ä¹ˆä¼šå¥”æºƒäº†å‘¢ï¼Ÿä»€ä¹ˆç©æ„å„¿ï¼Ÿå®¢å®˜åˆ«æ€¥ï¼Œè¯·å…ˆå°è¯•ä¸€ä¸‹ä¸‹é¢çš„æ–¹æ³•ï¼š</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> ServiceConnection conn = <span class="keyword">new</span> ServiceConnection()&#123;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span></span>&#123;</div><div class="line">        IDataAccess iDataAccess = IDataAccess.Stub.asInterface(service);</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                iDataAccess.accessData();</div><div class="line">            &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * å½“æœåŠ¡è¿æ¥å¼‚å¸¸ç»ˆæ­¢åè°ƒç”¨</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName name)</span></span>&#123;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å“å‘€ï¼å§æ§½ï¼å¯¹äº†ï¼</p>
<p>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹IDataAccess.Stub.asInterface(service)ç©¶ç«Ÿåšäº†ä»€ä¹ˆ</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> static <span class="literal">cn</span>.codempero.summary.IDataAccess asInterface(android.os.IBinder obj)&#123;</div><div class="line">    <span class="keyword">if</span> ((obj==<span class="built_in">null</span>)) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="built_in">null</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    android.os.IInterface iin = obj.queryLocalInterface(DESCRIPTOR);</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (((iin!=<span class="built_in">null</span>)&amp;&amp;(iin instanceof <span class="literal">cn</span>.codempero.summary.IDataAccess))) &#123;</div><div class="line">        <span class="keyword">return</span> ((<span class="literal">cn</span>.codempero.summary.IDataAccess)iin);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="literal">new</span> <span class="literal">cn</span>.codempero.summary.IDataAccess.Stub.Proxy(obj);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>çœ‹äº†ä»£ç ä¹‹åï¼Œä»”ç»†ä¸€æƒ³ï¼Œå¯¹å“Ÿï¼Œé€šè¿‡AIDLè®¿é—®çš„å¯æ˜¯è¿œç¨‹æœåŠ¡å“ï¼Œæ˜¯ä¸å¤„äºåŒä¸€ä¸ªè¿›ç¨‹çš„å‘€ï¼é‚£ä¹ˆä¼ é€’è¿‡æ¥çš„IBinderå¯¹è±¡ä¸å¯èƒ½æ˜¯æœ¬è¿›ç¨‹çš„IDataAccesså‘€ï¼Œæ‰€ä»¥å¿…é¡»ä½¿ç”¨ä»£ç†æ¥è®¿é—®ã€‚</p>
<p>è¯´äº†è¿™ä¹ˆå¤šï¼Œè¿œç¨‹Serviceä½¿ç”¨èµ·æ¥å¦‚æ­¤å¤æ‚ï¼Œå¥½åƒè¿˜ä¸çŸ¥é“ä¸ºä»€ä¹ˆè¦ç”¨è¿œç¨‹Serviceå‘¢ï¼Ÿ</p>
<p>è¿œç¨‹Serviceé€šå¸¸ç”¨æ¥æä¾›ä¸€äº›è¿›ç¨‹é—´å…±äº«çš„æœåŠ¡ï¼Œé€šä¿—ä¸€ç‚¹æ¥è¯´å°±æ˜¯ä¸ºæ‰‹æœºä¸Šçš„Appæä¾›ä¸€ä¸ªå…¬å…±çš„æœåŠ¡ï¼Œæ¯ä¸ªAppéƒ½å¯ä»¥è®¿é—®è¿™ä¸ªæœåŠ¡ã€‚</p>
<p>å‘µå‘µå‘µï¼Œé‚£æ€ä¹ˆåœ¨å…¶ä»–çš„Appä¸­è®¿é—®è¿œç¨‹æœåŠ¡å‘¢ï¼Ÿæ¯•ç«Ÿä¸åŒçš„Appæœ‰ä¸åŒçš„UIDå‘€ï¼</p>
<h2 id="åœ¨å…¶ä»–åº”ç”¨ç¨‹åºä¸­è®¿é—®è¿œç¨‹æœåŠ¡"><a href="#åœ¨å…¶ä»–åº”ç”¨ç¨‹åºä¸­è®¿é—®è¿œç¨‹æœåŠ¡" class="headerlink" title="åœ¨å…¶ä»–åº”ç”¨ç¨‹åºä¸­è®¿é—®è¿œç¨‹æœåŠ¡"></a>åœ¨å…¶ä»–åº”ç”¨ç¨‹åºä¸­è®¿é—®è¿œç¨‹æœåŠ¡</h2><p>æœ€ç»ˆæˆ‘ä»¬çš„ç›®çš„æ˜¯ï¼šæ‰€æœ‰å…·æœ‰æƒé™çš„åº”ç”¨ç¨‹åºéƒ½å¯ä»¥è®¿é—®è¿œç¨‹æœåŠ¡ã€‚é‚£ä¹ˆåªéœ€è¦éµå¾ªä»¥ä¸‹æµç¨‹å³å¯è®¿é—®åˆ°è¿œç¨‹æœåŠ¡ï¼š</p>
<h5 id="1-æ–°å»ºåä¸ºClientTesté¡¹ç›®"><a href="#1-æ–°å»ºåä¸ºClientTesté¡¹ç›®" class="headerlink" title="1. æ–°å»ºåä¸ºClientTesté¡¹ç›®"></a>1. æ–°å»ºåä¸ºClientTesté¡¹ç›®</h5><h5 id="2-å°†IDataAccess-aidlåŒåŒ…è·¯å¾„ä¸€èµ·æ‹·è´è¿‡æ¥ï¼ˆè¯¥è·¯å¾„éœ€è¦å’ŒClientTestè·¯å¾„åŒçº§ï¼‰"><a href="#2-å°†IDataAccess-aidlåŒåŒ…è·¯å¾„ä¸€èµ·æ‹·è´è¿‡æ¥ï¼ˆè¯¥è·¯å¾„éœ€è¦å’ŒClientTestè·¯å¾„åŒçº§ï¼‰" class="headerlink" title="2. å°†IDataAccess.aidlåŒåŒ…è·¯å¾„ä¸€èµ·æ‹·è´è¿‡æ¥ï¼ˆè¯¥è·¯å¾„éœ€è¦å’ŒClientTestè·¯å¾„åŒçº§ï¼‰"></a>2. å°†IDataAccess.aidlåŒåŒ…è·¯å¾„ä¸€èµ·æ‹·è´è¿‡æ¥ï¼ˆè¯¥è·¯å¾„éœ€è¦å’ŒClientTestè·¯å¾„åŒçº§ï¼‰</h5><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">|<span class="string">â€”â€”src</span></div><div class="line">|<span class="string">  â””â”€â”€ main</span></div><div class="line">|<span class="string">  </span>|<span class="string">  </span>|<span class="string">  â””â”€â”€ java</span></div><div class="line">|<span class="string">  </span>|<span class="string">  </span>|<span class="string">  â””â”€â”€ cn.codemperor.clienttest</span></div><div class="line">|<span class="string">  </span>|<span class="string">  </span>|<span class="string">  â””â”€â”€ cn.codemepror.summary</span></div><div class="line">|<span class="string">  </span>|<span class="string">  </span>|<span class="string">  </span>|<span class="string">  â””â”€â”€ IDataAccess.aidl</span></div></pre></td></tr></table></figure>
<h5 id="3-ä½¿ç”¨éšå¼Intentæ¥è®¿é—®è¿œç¨‹æœåŠ¡"><a href="#3-ä½¿ç”¨éšå¼Intentæ¥è®¿é—®è¿œç¨‹æœåŠ¡" class="headerlink" title="3. ä½¿ç”¨éšå¼Intentæ¥è®¿é—®è¿œç¨‹æœåŠ¡"></a>3. ä½¿ç”¨éšå¼Intentæ¥è®¿é—®è¿œç¨‹æœåŠ¡</h5><p>ä½†æ˜¯ï¼Œå‘µå‘µå‘µï¼Œandroid5.0åŠä»¥ä¸Šå¯æ˜¯ç¦æ­¢é€šè¿‡éšå¼intentçš„æ–¹å¼æ¥è®¿é—®Serviceçš„å‘€ã€‚æ‰€ä»¥å‘¢ï¼Ÿæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹shareUserIdå§ï¼ <img src="http://oc1ju78pc.bkt.clouddn.com/%E5%93%88%E5%93%88%E5%93%88_%E5%A7%9A%E6%98%8E.jpg" alt="å“ˆå“ˆ"> </p>
<p>åœ¨è¯´shareUserIdä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥è¯´ä¸€ä¸‹Androidä¸­çš„UIDå’ŒPIDå§ï¼</p>
<p>æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œä¸€ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥æœ‰å¤šä¸ªè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„PIDï¼Œé‚£ä¹ˆandroidä¸­æ˜¯å¦‚ä½•æ¥å”¯ä¸€æ ‡è¯†åº”ç”¨ç¨‹åºçš„å‘¢ï¼Ÿlinuxæ˜¯æ”¯æŒå¤šç”¨æˆ·å¤šè¿›ç¨‹çš„ï¼Œæ‰€ä»¥è®¾è®¡å¸ˆé‡‡ç”¨UIDæ¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªç”¨æˆ·ï¼Œä½†æ˜¯Androidä¸­åªæ”¯æŒå•ç”¨æˆ·ï¼Œæ‰€ä»¥Googleå°±å°†UIDæ¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªåº”ç”¨ç¨‹åºäº†ï¼Œåº”ç”¨ç¨‹åºä¹‹é—´ä¹Ÿå¯ä»¥é€šè¿‡UIDæ¥å®ç°æ•°æ®å…±äº«äº†ã€‚å‘µå‘µå“’ï¼Œè¯´äº†è¿™ä¹ˆå¤šï¼Œå…·ä½“åº”è¯¥æ€ä¹ˆå®ç°å‘¢ï¼Ÿso easy!åªéœ€è¦è®©ä¸¤ä¸ªåº”ç”¨ç¨‹åºæ‹¥æœ‰ç›¸åŒçš„shareUserIdå³å¯ã€‚</p>
<p> åº”ç”¨ç¨‹åºA</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;manifest <span class="string">xmlns:</span>android=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">          <span class="keyword">package</span>=<span class="string">"com.codemperor.aApplication"</span></div><div class="line"><span class="symbol">ã€€ã€€ã€€ã€€ã€€ android:</span>versionCode=<span class="string">"1"</span></div><div class="line"><span class="symbol">ã€€ã€€ã€€ã€€ã€€ android:</span>versionName=<span class="string">"1.0"</span></div><div class="line"><span class="symbol">          android:</span>sharedUserId=<span class="string">"com.codemperor.share"</span>/&gt;</div></pre></td></tr></table></figure>
<p>åº”ç”¨ç¨‹åºB
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;manifest <span class="string">xmlns:</span>android=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">          <span class="keyword">package</span>=<span class="string">"com.codemperor.bApplication"</span></div><div class="line"><span class="symbol">ã€€ã€€ã€€ã€€ã€€android:</span>versionCode=<span class="string">"1"</span></div><div class="line"><span class="symbol">ã€€ã€€ã€€ã€€ã€€android:</span>versionName=<span class="string">"1.0"</span></div><div class="line"><span class="symbol">          android:</span>sharedUserId=<span class="string">"com.codemperor.share"</span>/&gt;</div></pre></td></tr></table></figure></p>
<p>å“ˆå“ˆå“ˆï¼Œç°åœ¨æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æ˜¾ç¤ºintentçš„æ–¹å¼æ¥ç»‘å®šè¿œç¨‹Serviceäº†ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡åŒæ ·çš„æ–¹å¼å¯åŠ¨Activityï¼Œæœ¬åœ°Serviceï¼ŒBroadcastReceiverï¼‰ã€‚ä½†æ˜¯æœºæ™ºçš„æœ‹å‹å°±ä¼šé—®äº†ï¼šå¦‚æœæˆ‘çŸ¥é“äº†ä½ çš„shareUserIdï¼Œé‚£ä¹ˆæˆ‘å°±å¯ä»¥éšæ„è®¿é—®ä½ çš„åº”ç”¨ç¨‹åºå’¯ï¼Ÿå“ˆå“ˆï¼ŒGoogleæ€ä¼šå¦‚æ­¤lowBï¼Œå¼€å‘è€…éƒ½çŸ¥é“åœ¨æ‰“åŒ…Appæ—¶ï¼Œéƒ½ä¼šæœ‰è‡ªå·±çš„ç­¾åæ–‡ä»¶ï¼Œè€Œä¸”è¯¥ç­¾åæ–‡ä»¶å¯æ˜¯æœºå¯†å“Ÿã€‚ä¸åŒç­¾åçš„Appå¯æ˜¯ä¸èƒ½å®ç°æ•°æ®å…±äº«çš„ã€‚</p>
<h2 id="åœ¨è¿œç¨‹æœåŠ¡ä¸­ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹"><a href="#åœ¨è¿œç¨‹æœåŠ¡ä¸­ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹" class="headerlink" title="åœ¨è¿œç¨‹æœåŠ¡ä¸­ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹"></a>åœ¨è¿œç¨‹æœåŠ¡ä¸­ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹</h2><p>å‰é¢æˆ‘ä»¬æåˆ°ï¼Œåœ¨è¿œç¨‹æœåŠ¡ä¸­ï¼Œä»…æ”¯æŒå‡ ç§ç±»å‹çš„æ•°æ®ï¼Œè™½ç„¶æ”¯æŒè‡ªå®šä¹‰ç±»å‹ï¼Œä½†ç”¨æ³•æœ‰æ‰€ä¸åŒã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªCatç±»å‹ã€‚æ®<a href="https://developer.android.com/guide/components/aidl.html#PassingObjects" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£è¯´æ˜</a>,è¦å†è¿œç¨‹æœåŠ¡ä¸­ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹å¿…é¡»<a href="https://developer.android.com/reference/android/os/Parcelable.html" target="_blank" rel="external">Parcelable</a>ã€‚
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">package cn.codemperor.summary.bean;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Cat</span> <span class="title">implement</span> <span class="title">Parcelable</span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> final Parcelable.Creator&lt;Cat&gt; CREATOR = <span class="keyword">new</span></div><div class="line">            Parcelable.Creator&lt;Cat&gt;() &#123;</div><div class="line">                <span class="function"><span class="keyword">public</span> Cat <span class="title">createFromParcel</span>(<span class="params">Parcel <span class="keyword">in</span></span>) </span>&#123;</div><div class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> Cat(<span class="keyword">in</span>);</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                <span class="function"><span class="keyword">public</span> Cat[] <span class="title">newArray</span>(<span class="params"><span class="keyword">int</span> size</span>) </span>&#123;</div><div class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> Cat[size];</div><div class="line">                &#125;</div><div class="line">            &#125;;</div><div class="line"></div><div class="line">    String name;</div><div class="line">    String host;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Cat</span>(<span class="params">Parcel <span class="keyword">in</span></span>) </span>&#123;</div><div class="line">        name = <span class="keyword">in</span>.readString();</div><div class="line">        host = <span class="keyword">in</span>.readString();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @<span class="function">Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">describeContents</span>(<span class="params"></span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @<span class="function">Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeToParcel</span>(<span class="params">Parcel dest, <span class="keyword">int</span> flags</span>) &#123;</div><div class="line">        dest.writeString(name);</div><div class="line">        dest.writeString(host);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ç„¶ååœ¨Catæ‰€åœ¨çš„åŒ…ä¸‹åˆ›å»ºä¸€ä¸ªå’Œè‡ªå®šä¹‰ç±»å‹CatåŒåçš„aidlæ–‡ä»¶ï¼Œé‡Œé¢çš„å†…å®¹å›ºå®šä¸ºï¼š</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Cat.aidl</span></div><div class="line"><span class="keyword">package</span> cn.codemperor.summary.bean;</div><div class="line"></div><div class="line"><span class="comment">// Declare Rect so AIDL can find it and knows that it implements</span></div><div class="line"><span class="comment">// the parcelable protocol.</span></div><div class="line">parcelable Cat;</div></pre></td></tr></table></figure>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šCat.aidlå’ŒCat.javaçš„åŒ…åå¿…é¡»ä¸€è‡´ï¼Œå¦åˆ™ä¼šæŸ¥æ‰¾ä¸åˆ°ã€‚</p>
</blockquote>
<p>é‚£ä¹ˆï¼Œç°åœ¨æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Catç±»å‹äº†</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//å¯¼å…¥Catç±»ï¼Œå¿…é¡»å†™</span></div><div class="line">import cn.codemperor.summary.bean.Cat;</div><div class="line"></div><div class="line"><span class="keyword">interface</span> <span class="title">IDataAccess</span> &#123;</div><div class="line"></div><div class="line">    <span class="function">boolean <span class="title">accessData</span>(<span class="params"></span>)</span>;</div><div class="line"></div><div class="line">    <span class="function">Cat <span class="title">getCat</span>(<span class="params"></span>)</span>;</div><div class="line">    </div><div class="line">    <span class="comment">/**</span></div><div class="line">     * å¦‚æœè¦åœ¨å‚æ•°ä¸­ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹ï¼Œå¿…é¡»æ·»åŠ inä¿®é¥°ç¬¦</div><div class="line">     **/</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setCat</span>(<span class="params"><span class="keyword">in</span> Cat cat</span>)</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Demonstrates some basic types that you can use as parameters</div><div class="line">     * and return values in AIDL.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">basicTypes</span>(<span class="params"><span class="keyword">int</span> anInt, <span class="keyword">long</span> aLong, boolean aBoolean, <span class="keyword">float</span> aFloat,</span></span></div><div class="line">            <span class="keyword">double</span> aDouble, String aString);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æœ€ååœ¨DataAccessBinderä¸­é‡å†™getCat(), setCat(in Cat cat)å³å¯ã€‚</p>
<p><strong>å“ˆå“ˆï¼Œå‰æ–¹é«˜èƒ½ï¼Œå‰æ–¹é«˜èƒ½ï¼Œå‰æ–¹é«˜èƒ½</strong>
ç»è¿‡æµ‹è¯•ï¼Œä½¿ç”¨getCat()è¿”å›çš„Catå¯¹è±¡ä¸ä¸ºç©ºï¼Œä½†æ˜¯cat.name, cat.hostä¸ºnullã€‚</p>
<h1 id="å…¶ä»–è¿›ç¨‹é—´é€šè®¯çš„æ–¹å¼"><a href="#å…¶ä»–è¿›ç¨‹é—´é€šè®¯çš„æ–¹å¼" class="headerlink" title="å…¶ä»–è¿›ç¨‹é—´é€šè®¯çš„æ–¹å¼"></a>å…¶ä»–è¿›ç¨‹é—´é€šè®¯çš„æ–¹å¼</h1><h2 id="Messager"><a href="#Messager" class="headerlink" title="Messager"></a>Messager</h2><p>è¯¥éƒ¨åˆ†è¾ƒä¸ºç®€å•ï¼Œ<a href="https://developer.android.com/guide/components/bound-services.html#Messenger" target="_blank" rel="external">ç‚¹æˆ‘</a>æŸ¥çœ‹ç”¨æ³•ã€‚</p>
<h1 id="ä¸€äº›Serviceä¿æ´»çš„æ–¹æ³•"><a href="#ä¸€äº›Serviceä¿æ´»çš„æ–¹æ³•" class="headerlink" title="ä¸€äº›Serviceä¿æ´»çš„æ–¹æ³•"></a>ä¸€äº›Serviceä¿æ´»çš„æ–¹æ³•</h1><h2 id="å‰å°Service"><a href="#å‰å°Service" class="headerlink" title="å‰å°Service"></a>å‰å°Service</h2><p>å…·ä½“å‚è§<a href="http://zhoujianghua.com/2015/07/28/black_technology_in_alipay/" target="_blank" rel="external">è¿™é‡Œ</a>,ä½œè€…å†™çš„æµ…æ˜¾æ˜“æ‡‚ã€‚</p>
<h2 id="onStartCommandçš„è¿”å›å€¼"><a href="#onStartCommandçš„è¿”å›å€¼" class="headerlink" title="onStartCommandçš„è¿”å›å€¼"></a>onStartCommandçš„è¿”å›å€¼</h2><p>ä¸ç”¨å†è¯´äº†å§ï¼Œå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ<img src="http://oc1ju78pc.bkt.clouddn.com/%E5%93%88%E5%93%88%E5%93%88_%E5%A7%9A%E6%98%8E.jpg" alt="æ­¤å¤„è¾“å…¥å›¾ç‰‡çš„æè¿°"></p>
<h1 id="ä¸€äº›å°çŸ¥è¯†ç‚¹"><a href="#ä¸€äº›å°çŸ¥è¯†ç‚¹" class="headerlink" title="ä¸€äº›å°çŸ¥è¯†ç‚¹"></a>ä¸€äº›å°çŸ¥è¯†ç‚¹</h1><h2 id="android-processçš„å€¼"><a href="#android-processçš„å€¼" class="headerlink" title="android:processçš„å€¼"></a>android:processçš„å€¼</h2><p>(1). android:process=â€com.xxx.xxxx.remoteâ€ å®Œæ•´çš„å‘½åæ–¹å¼ï¼Œå±äºå…¨å±€è¿›ç¨‹ï¼Œå…¶å®ƒåº”ç”¨é€šè¿‡ShareUIDæ–¹å¼å¯ä»¥å’Œå®ƒè·‘åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ã€‚</p>
<p>(2). android:process=â€:remoteâ€ï¼Œè¿›ç¨‹ä»¥â€œ:â€å¼€å¤´çš„è¿›ç¨‹å±äºå½“å‰åº”ç”¨çš„ç§æœ‰è¿›ç¨‹ï¼Œå…¶å®ƒåº”ç”¨çš„ç»„ä»¶ä¸å¯ä»¥å’Œå®ƒè·‘åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œâ€œ:â€å‘½åçš„è¿›ç¨‹ä¼šåœ¨å½“å‰çš„è¿›ç¨‹åä¹‹å‰é™„åŠ ä¸ŠåŒ…åå¦‚ï¼šâ€œcom.xxx.xxxx:remoteâ€ã€‚</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>å¦‚æœæˆ‘çš„æ–‡ç« å¯¹æ‚¨æœ‰ç”¨ï¼Œè¯·ç»™æˆ‘åŠ¨åŠ›å§ï¼O(âˆ©_âˆ©)Oå“ˆå“ˆ~</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>èµ</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="/images/wechat_pay.png" alt="codempror WeChat Pay"/>
          <p>å¾®ä¿¡æ‰“èµ</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="/images/ali_pay.jpg" alt="codempror Alipay"/>
          <p>æ”¯ä»˜å®æ‰“èµ</p>
        </div>
      
    </div>
  </div>


      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Service/" rel="tag">#Service</a>
          
            <a href="/tags/IntentService/" rel="tag">#IntentService</a>
          
            <a href="/tags/AIDL/" rel="tag">#AIDL</a>
          
            <a href="/tags/è¿œç¨‹æœåŠ¡/" rel="tag">#è¿œç¨‹æœåŠ¡</a>
          
            <a href="/tags/Serviceä¿æ´»/" rel="tag">#Serviceä¿æ´»</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/08/18/android-Activityä¸Fragment/" rel="next" title="android-Activityä¸Fragment">
                <i class="fa fa-chevron-left"></i> android-Activityä¸Fragment
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/08/24/android-BroadCastä¸StickBroadCast/" rel="prev" title="android-Broadcast">
                android-Broadcast <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/08/23/android-Serviceä¸IntentService/"
           data-title="android-Serviceä¸IntentService" data-url="http://yoursite.com/2016/08/23/android-Serviceä¸IntentService/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="codempror" />
          <p class="site-author-name" itemprop="name">codempror</p>
          <p class="site-description motion-element" itemprop="description">Just do it.</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">25</span>
              <span class="site-state-item-name">æ—¥å¿—</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">30</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Serviceæ˜¯ä»€ä¹ˆï¼Ÿ"><span class="nav-number">1.</span> <span class="nav-text">Serviceæ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Serviceçš„åŸºæœ¬ç”¨æ³•ã€‚"><span class="nav-number">2.</span> <span class="nav-text">Serviceçš„åŸºæœ¬ç”¨æ³•ã€‚</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Service-onStartCommand-çš„è¿”å›å€¼"><span class="nav-number">3.</span> <span class="nav-text">Service#onStartCommand()çš„è¿”å›å€¼</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#IntentServiceçš„åŸºæœ¬ç”¨æ³•åŠåŸç†"><span class="nav-number">4.</span> <span class="nav-text">IntentServiceçš„åŸºæœ¬ç”¨æ³•åŠåŸç†</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#IntentServiceçš„åŸºæœ¬ç”¨æ³•"><span class="nav-number">4.1.</span> <span class="nav-text">IntentServiceçš„åŸºæœ¬ç”¨æ³•</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IntentServiceåŸç†è§£æ"><span class="nav-number">4.2.</span> <span class="nav-text">IntentServiceåŸç†è§£æ</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Bound-Service"><span class="nav-number">5.</span> <span class="nav-text">Bound Service</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#æœ¬åœ°ç»‘å®š"><span class="nav-number">5.1.</span> <span class="nav-text">æœ¬åœ°ç»‘å®š</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#è¿œç¨‹ç»‘å®š"><span class="nav-number">5.2.</span> <span class="nav-text">è¿œç¨‹ç»‘å®š</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#AIDLåŸºæœ¬æ¦‚å¿µåŠç”¨é€”"><span class="nav-number">5.2.1.</span> <span class="nav-text">AIDLåŸºæœ¬æ¦‚å¿µåŠç”¨é€”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è¿œç¨‹æœåŠ¡å®ä¾‹â€“æ•°æ®è®¿é—®"><span class="nav-number">5.2.2.</span> <span class="nav-text">è¿œç¨‹æœåŠ¡å®ä¾‹â€“æ•°æ®è®¿é—®</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åœ¨å…¶ä»–åº”ç”¨ç¨‹åºä¸­è®¿é—®è¿œç¨‹æœåŠ¡"><span class="nav-number">5.3.</span> <span class="nav-text">åœ¨å…¶ä»–åº”ç”¨ç¨‹åºä¸­è®¿é—®è¿œç¨‹æœåŠ¡</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-æ–°å»ºåä¸ºClientTesté¡¹ç›®"><span class="nav-number">5.3.0.0.1.</span> <span class="nav-text">1. æ–°å»ºåä¸ºClientTesté¡¹ç›®</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-å°†IDataAccess-aidlåŒåŒ…è·¯å¾„ä¸€èµ·æ‹·è´è¿‡æ¥ï¼ˆè¯¥è·¯å¾„éœ€è¦å’ŒClientTestè·¯å¾„åŒçº§ï¼‰"><span class="nav-number">5.3.0.0.2.</span> <span class="nav-text">2. å°†IDataAccess.aidlåŒåŒ…è·¯å¾„ä¸€èµ·æ‹·è´è¿‡æ¥ï¼ˆè¯¥è·¯å¾„éœ€è¦å’ŒClientTestè·¯å¾„åŒçº§ï¼‰</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-ä½¿ç”¨éšå¼Intentæ¥è®¿é—®è¿œç¨‹æœåŠ¡"><span class="nav-number">5.3.0.0.3.</span> <span class="nav-text">3. ä½¿ç”¨éšå¼Intentæ¥è®¿é—®è¿œç¨‹æœåŠ¡</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åœ¨è¿œç¨‹æœåŠ¡ä¸­ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹"><span class="nav-number">5.4.</span> <span class="nav-text">åœ¨è¿œç¨‹æœåŠ¡ä¸­ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#å…¶ä»–è¿›ç¨‹é—´é€šè®¯çš„æ–¹å¼"><span class="nav-number">6.</span> <span class="nav-text">å…¶ä»–è¿›ç¨‹é—´é€šè®¯çš„æ–¹å¼</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Messager"><span class="nav-number">6.1.</span> <span class="nav-text">Messager</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ä¸€äº›Serviceä¿æ´»çš„æ–¹æ³•"><span class="nav-number">7.</span> <span class="nav-text">ä¸€äº›Serviceä¿æ´»çš„æ–¹æ³•</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#å‰å°Service"><span class="nav-number">7.1.</span> <span class="nav-text">å‰å°Service</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#onStartCommandçš„è¿”å›å€¼"><span class="nav-number">7.2.</span> <span class="nav-text">onStartCommandçš„è¿”å›å€¼</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ä¸€äº›å°çŸ¥è¯†ç‚¹"><span class="nav-number">8.</span> <span class="nav-text">ä¸€äº›å°çŸ¥è¯†ç‚¹</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#android-processçš„å€¼"><span class="nav-number">8.1.</span> <span class="nav-text">android:processçš„å€¼</span></a></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">codempror</span>
</div>

<div class="powered-by">
  ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
æœ¬ç«™æ€»è®¿é—®é‡ <span id="busuanzi_value_site_pv"></span> &nbsp&nbsp&nbsp</span></a>


        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"zhiho"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  

</body>
</html>
